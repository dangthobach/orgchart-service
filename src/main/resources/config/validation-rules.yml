# ================================================================
# Validation Rules Configuration
# Declarative validation rules for each sheet type
# ================================================================

rules:
  # ----------------------------------------------------------------
  # HopDong Validation Rules
  # ----------------------------------------------------------------
  hop_dong_required_fields:
    type: REQUIRED_FIELDS
    enabled: true
    description: "Validate required fields for HopDong sheet"
    fields:
      - vpbankWarehouse
      - unitCode
      - contractNumber
      - folderQuantity
      - disbursementDate
      - documentType
      - retentionPeriodCategory
      - boxCode

  hop_dong_date_formats:
    type: DATE_FORMAT
    enabled: true
    description: "Validate date formats"
    dateFormat: "yyyy-MM-dd"
    fields:
      - requiredHandoverDate
      - actualHandoverDate
      - disbursementDate
      - dueDate
      - expectedDestructionDate
      - vpbankWarehouseEntryDate
      - crownWarehouseTransferDate

  hop_dong_enum_values:
    type: ENUM_VALUES
    enabled: true
    description: "Validate enum field values"
    rules:
      documentType:
        allowedValues: [LD, MD, CC, OD, TTK, HDHM, TSBD, KSSV, "Bao thanh toán", "Biên nhận thế chấp"]
      retentionPeriodCategory:
        allowedValues: ["Vĩnh viễn", "Ngắn hạn", "Trung hạn", "Dài hạn"]

  hop_dong_business_logic:
    type: BUSINESS_LOGIC
    enabled: true
    description: "Business logic validation"
    rules:
      - name: "validate_destruction_date"
        description: "Ngày dự kiến tiêu hủy must match retentionPeriodCategory"
        field: "expectedDestructionDate"
        customValidator: "HopDongBusinessRuleValidator.validateDestructionDate"

      - name: "validate_ma_thung_format"
        description: "Mã thùng: chỉ chữ in hoa, số, dấu gạch dưới"
        field: "boxCode"
        pattern: "^[A-Z0-9_]+$"

      - name: "validate_thoi_han_cap_td"
        description: "Thời hạn cấp TD phải là số nguyên dương"
        field: "retentionPeriodYears"
        dataType: "INTEGER_POSITIVE"

  hop_dong_duplicate_check:
    type: DUPLICATE_CHECK
    enabled: true
    description: "Check duplicate within file and DB"
    rules:
      - condition: "documentType IN (LD,MD,OD,HDHM,KSSV,Bao thanh toán,Biên nhận thế chấp)"
        businessKey: ["contractNumber", "documentType", "disbursementDate"]

      - condition: "documentType IN (CC,TSBD)"
        businessKey: ["contractNumber", "documentType", "customerCif"]

      - condition: "documentType = TTK"
        businessKey: ["contractNumber", "documentType", "customerCif", "unitCode", "disbursementDate"]

  hop_dong_master_references:
    type: MASTER_REFERENCE
    enabled: true
    description: "Validate references to master tables"
    references:
      - field: "vpbankWarehouse"
        masterTable: "warehouse"
        masterColumn: "code"
        condition: "is_active = true"

      - field: "unitCode"
        masterTable: "unit"
        masterColumn: "code"
        condition: "is_active = true"

  # ----------------------------------------------------------------
  # CIF Validation Rules
  # ----------------------------------------------------------------
  cif_required_fields:
    type: REQUIRED_FIELDS
    enabled: true
    description: "Validate required fields for CIF sheet"
    fields:
      - vpbankWarehouse
      - unitCode
      - customerCif
      - folderQuantity
      - disbursementDate
      - documentType
      - documentFlow
      - retentionPeriodCategory
      - boxCode

  cif_date_formats:
    type: DATE_FORMAT
    enabled: true
    description: "Validate date formats"
    dateFormat: "yyyy-MM-dd"
    fields:
      - requiredHandoverDate
      - actualHandoverDate
      - disbursementDate
      - vpbankWarehouseEntryDate
      - crownWarehouseTransferDate

  cif_enum_values:
    type: ENUM_VALUES
    enabled: true
    description: "Validate enum field values"
    rules:
      documentType:
        allowedValues: ["PASS TTN", "SCF VEERFIN", "Trình cấp TD không qua CPC", "Hồ sơ mở TKTT nhưng không giải ngân"]
      documentFlow:
        allowedValues: ["HSTD thường"]
      retentionPeriodCategory:
        allowedValues: ["Vĩnh viễn"]

  cif_business_logic:
    type: BUSINESS_LOGIC
    enabled: true
    description: "Business logic validation"
    rules:
      - name: "validate_ma_thung_format"
        description: "Mã thùng: chỉ chữ in hoa, số, dấu gạch dưới"
        field: "boxCode"
        pattern: "^[A-Z0-9_]+$"

  cif_duplicate_check:
    type: DUPLICATE_CHECK
    enabled: true
    description: "Check duplicate: CIF + Ngày giải ngân + Loại HS"
    rules:
      - businessKey: ["customerCif", "disbursementDate", "documentType"]

  cif_master_references:
    type: MASTER_REFERENCE
    enabled: true
    description: "Validate references to master tables"
    references:
      - field: "vpbankWarehouse"
        masterTable: "warehouse"
        masterColumn: "code"
        condition: "is_active = true"

  # ----------------------------------------------------------------
  # Tap Validation Rules
  # ----------------------------------------------------------------
  tap_required_fields:
    type: REQUIRED_FIELDS
    enabled: true
    description: "Validate required fields for Tap sheet"
    fields:
      - vpbankWarehouse
      - unitCode
      - handoverResponsibility
      - incidentMonth
      - folderQuantity
      - documentType
      - documentFlow
      - retentionPeriodCategory
      - expectedDestructionDate
      - product
      - boxCode

  tap_date_formats:
    type: DATE_FORMAT
    enabled: true
    description: "Validate date formats"
    dateFormat: "yyyy-MM-dd"
    fields:
      - requiredHandoverDate
      - actualHandoverDate
      - expectedDestructionDate
      - vpbankWarehouseEntryDate
      - crownWarehouseTransferDate

  tap_enum_values:
    type: ENUM_VALUES
    enabled: true
    description: "Validate enum field values"
    rules:
      documentType:
        allowedValues: ["KSSV"]
      documentFlow:
        allowedValues: ["HSTD thường"]
      retentionPeriodCategory:
        allowedValues: ["Vĩnh viễn"]
      product:
        allowedValues: ["KSSV"]

  tap_business_logic:
    type: BUSINESS_LOGIC
    enabled: true
    description: "Business logic validation"
    rules:
      - name: "validate_destruction_date_9999"
        description: "Ngày dự kiến tiêu hủy must be 31-Dec-9999"
        field: "expectedDestructionDate"
        customValidator: "TapBusinessRuleValidator.validateDestructionDate9999"

      - name: "validate_ma_thung_format"
        description: "Mã thùng: chỉ chữ in hoa, số, dấu gạch dưới"
        field: "boxCode"
        pattern: "^[A-Z0-9_]+$"

  tap_duplicate_check:
    type: DUPLICATE_CHECK
    enabled: true
    description: "Check duplicate: Mã DV + TNBG + Tháng PS + Sản phẩm"
    rules:
      - businessKey: ["unitCode", "handoverResponsibility", "incidentMonth", "product"]

  tap_master_references:
    type: MASTER_REFERENCE
    enabled: true
    description: "Validate references to master tables"
    references:
      - field: "vpbankWarehouse"
        masterTable: "warehouse"
        masterColumn: "code"
        condition: "is_active = true"
